{% extends 'base.html' %}

{% block content %}
<div class="box">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em;">
        <div style="flex: 1;">
            <h2>Screenshot Preview - {{ watch.label or watch.url }}</h2>
            <a href="{{ url_for('ui.form_watch_checknow', uuid=uuid) }}" class="pure-button button-small button-primary">Recheck</a>
            <a href="{{ url_for('ui.ui_diff.diff_history_page', uuid=uuid) }}" class="pure-button button-small">View Diff History</a>
            <a href="{{ url_for('ui.ui_edit.edit_page', uuid=uuid) }}" class="pure-button button-small">Edit</a>
        </div>
    </div>

    <div id="settings" style="margin-bottom: 1.5em; padding: 1em; background: #f5f5f5; border-radius: 4px;">
        <form action="{{ url_for('ui.ui_preview.preview_page', uuid=uuid) }}">
            <fieldset>
                <legend>Preview Options</legend>
                <div class="pure-control-group">
                    <label for="version">Version:</label>
                    <select name="version" id="version" onchange="this.form.submit()" class="pure-input-1-3">
                        {% for version_timestamp in versions|reverse %}
                        <option value="{{ version_timestamp }}" {% if version_timestamp == timestamp %}selected{% endif %}>
                            {{ version_timestamp|format_timestamp_timeago }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="pure-control-group">
                    <label for="url">Watching:</label>
                    <a href="{{ current_diff_url }}" target="_blank" rel="noopener" style="word-break: break-all;">{{ current_diff_url }}</a>
                </div>
            </fieldset>
        </form>
    </div>

    <div id="screenshot-container" style="text-align: center; border: 1px solid #ddd; padding: 2em; background: #fafafa; border-radius: 4px;">
        <h3 style="margin-top: 0;">Screenshot from {{ timestamp|format_timestamp_timeago }}</h3>
        <img src="data:{{ mime_type }};base64,{{ img_b64 }}"
             alt="Screenshot preview"
             style="max-width: 100%; height: auto; border: 1px solid #ccc; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 2px;">
    </div>

    <div style="margin-top: 2em; padding: 1em; background: #f9f9f9; border-left: 4px solid #4CAF50;">
        <h3 style="margin-top: 0;">About SSIM Screenshot Monitoring</h3>
        <p>This watch uses <strong>Structural Similarity Index (SSIM)</strong> to detect visual changes in screenshots.</p>
        <ul style="margin-left: 2em;">
            <li><strong>Robust to antialiasing</strong> - Ignores minor rendering differences between browser runs</li>
            <li><strong>Configurable sensitivity</strong> - Adjust threshold to catch major or minor changes</li>
            <li><strong>Visual diff</strong> - Changed regions highlighted in red in diff view</li>
            <li><strong>Works with direct images</strong> - Can monitor JPEG/PNG URLs without browser rendering</li>
        </ul>
        <p>
            <a href="{{ url_for('ui.ui_diff.diff_history_page', uuid=uuid) }}" class="pure-button button-small">View Diff History</a>
            to see what changed between versions.
        </p>
    </div>
</div>
{% endblock %}
