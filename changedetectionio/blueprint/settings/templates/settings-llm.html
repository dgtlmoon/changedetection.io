<script>
var LLM_CONNECTIONS = {{ settings_application.get('llm_connections', {})|tojson }};
var LLM_I18N = {
    noConnections:     '{{ _("No connections configured yet.") }}',
    setDefault:        '{{ _("Set as default") }}',
    remove:            '{{ _("Remove") }}',
    show:              '{{ _("show") }}',
    hide:              '{{ _("hide") }}',
    nameModelRequired: '{{ _("Name and Model string are required.") }}'
};
</script>

{# ── Configured connections table ──────────────────── #}
<fieldset>
    <legend>{{ _('LLM Connections') }}</legend>

    <table class="pure-table pure-table-horizontal llm-connections">
        <thead>
            <tr>
                <th class="llm-col-def" title="{{ _('Default') }}">{{ _('Default') }}</th>
                <th class="llm-col-name">{{ _('Name') }}</th>
                <th class="llm-col-model">{{ _('Model') }}</th>
                <th class="llm-col-key">{{ _('API Key') }}</th>
                <th class="llm-col-tpm" title="{{ _('Tokens per minute limit (0 = unlimited)') }}">{{ _('TPM') }}</th>
                <th class="llm-col-del"></th>
            </tr>
        </thead>
        <tbody id="llm-connections-tbody">
        </tbody>
    </table>
</fieldset>

{# ── Add connection ─────────────────────────────────── #}
<fieldset>
    <legend>{{ _('Add a connection') }}</legend>

    <div class="pure-control-group">
        <label for="llm-preset">{{ _('Provider template') }}</label>
        <select id="llm-preset" class="pure-input-1-2">
            <option value="">— {{ _('select a provider template') }} —</option>
            <optgroup label="{{ _('Cloud') }}">
                <option value="openai-mini">OpenAI — gpt-4o-mini</option>
                <option value="openai-4o">OpenAI — gpt-4o</option>
                <option value="anthropic-haiku">Anthropic — claude-3-haiku</option>
                <option value="anthropic-sonnet">Anthropic — claude-3-5-sonnet</option>
                <option value="groq-8b">Groq — llama-3.1-8b-instant</option>
                <option value="groq-70b">Groq — llama-3.3-70b-versatile</option>
                <option value="gemini-flash">Google — gemini-1.5-flash</option>
                <option value="mistral-small">Mistral — mistral-small</option>
                <option value="deepseek">DeepSeek — deepseek-chat</option>
                <option value="openrouter">OpenRouter (custom model)</option>
            </optgroup>
            <optgroup label="{{ _('Local') }}">
                <option value="ollama-llama">Ollama — llama3.1</option>
                <option value="ollama-mistral">Ollama — mistral</option>
                <option value="lmstudio">LM Studio</option>
            </optgroup>
            <optgroup label="{{ _('Custom') }}">
                <option value="custom">{{ _('Manual entry') }}</option>
            </optgroup>
        </select>
    </div>

    <div class="pure-g">
        <div class="pure-u-1 pure-u-md-1-2">
            <div class="pure-control-group">
                <label for="llm-add-name">{{ _('Name') }}</label>
                <input type="text" id="llm-add-name" class="pure-input-1"
                       placeholder="{{ _('e.g. My OpenAI') }}" autocomplete="off">
            </div>
        </div>
        <div class="pure-u-1 pure-u-md-1-2">
            <div class="pure-control-group">
                <label for="llm-add-model">{{ _('Model string') }}</label>
                <input type="text" id="llm-add-model" class="pure-input-1"
                       placeholder="gpt-4o-mini" autocomplete="off">
            </div>
        </div>
        <div class="pure-u-1 pure-u-md-1-2">
            <div class="pure-control-group">
                <label for="llm-add-key">
                    {{ _('API Key') }}
                    <span class="pure-form-message-inline">({{ _('leave blank for local') }})</span>
                </label>
                <div class="llm-key-wrap">
                    <input type="password" id="llm-add-key" class="pure-input-1"
                           placeholder="sk-…" autocomplete="off">
                    <button type="button" id="llm-key-toggle" class="pure-button">{{ _('show') }}</button>
                </div>
            </div>
        </div>
        <div class="pure-u-1 pure-u-md-1-2">
            <div class="pure-control-group">
                <label for="llm-add-base">
                    {{ _('Base URL') }}
                    <span class="pure-form-message-inline">({{ _('optional') }})</span>
                </label>
                <input type="text" id="llm-add-base" class="pure-input-1"
                       placeholder="http://localhost:11434" autocomplete="off">
            </div>
        </div>
        <div class="pure-u-1 pure-u-md-1-2">
            <div class="pure-control-group">
                <label for="llm-add-tpm">
                    {{ _('Tokens/min limit') }}
                    <span class="pure-form-message-inline">({{ _('0 = unlimited') }})</span>
                </label>
                <input type="number" id="llm-add-tpm" class="pure-input-1"
                       min="0" step="1000" value="0" placeholder="0">
            </div>
        </div>
    </div>

    <div class="pure-controls">
        <button type="button" id="llm-btn-add" class="pure-button pure-button-primary">{{ _('+ Add connection') }}</button>
    </div>
</fieldset>

{# Hidden field carries the JSON to the backend #}
<input type="hidden" name="llm_connections" id="llm-connections-json">
