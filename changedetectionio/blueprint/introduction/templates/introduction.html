{% extends 'base.html' %}
{% block content %}
    {% from '_helpers.html' import render_button, render_field %}
    <div class="edit-form">
        <div class="box-wrap inner">
            <form class="pure-form" action="{{ url_for('introduction.index_post') }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <h2>Welcome to changedetection.io</h2>

                <p>Please configure / confirm your local default time zone, for example <strong>Europe/Copenhagen</strong></p>

                <p>This is used for setting a schedule on webpage watches.</p>

                <p>Please check that the "local time" once you select a timezone is correct.</p>

                <script>

                    function getTimeInTimezone(timezone) {
                        const now = new Date();
                        const options = {
                            timeZone: timezone,
                            weekday: 'long',
                            year: 'numeric',
                            hour12: false,
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                        };

                        const formatter = new Intl.DateTimeFormat('en-US', options);
                        return formatter.format(now);
                    }

                    document.addEventListener("DOMContentLoaded", () => {
                        const v = document.getElementById('default_timezone');
                        const localTimeElement = document.getElementById('local-time-in-tz');

                        // Set a default based on the browser's timezone
                        v.value = Intl.DateTimeFormat().resolvedOptions().timeZone;


                        // Update the local time display every 500ms
                        window.setInterval(function () {
                          if (v.value.length) {
                            try {
                              // Pass the timezone string, not the element
                              localTimeElement.textContent = getTimeInTimezone(v.value);
                            } catch (error) {
                              console.warning("Invalid timezone specified:", v.value);
                              localTimeElement.textContent = "Invalid timezone";
                            }
                          }
                        }, 500);
                    });

                </script>
                <fieldset>
                    <p>
                    <div id="timezone-info">{{ render_field(form.default_timezone) }}<span id="local-time-in-tz"></span>
                    </div>
                    <datalist id="timezones" style="display: none;">
                        {% for timezone in available_timezones %}
                            <option value="{{ timezone }}">{{ timezone }}</option>
                        {% endfor %}
                    </datalist>
                    </p>
                </fieldset>
                {{ render_button(form.save_button) }}
            </form>
        </div>
    </div>


{% endblock %}
